<!DOCTYPE html>
<html>
<head>
  <title>Connection Test</title>
</head>
<body>
  <h1>Connection Test</h1>
  <button id="testBtn">Test Connection</button>
  <pre id="output"></pre>

  <script src="https://unpkg.com/colyseus.js@^0.15.0/dist/colyseus.js"></script>
  <script>
    const output = document.getElementById('output');

    function log(msg) {
      output.textContent += msg + '\n';
      console.log(msg);
    }

    document.getElementById('testBtn').addEventListener('click', async () => {
      try {
        output.textContent = '';
        log('Testing Colyseus connection...');
        log('Server URL: ws://' + window.location.host);

        const client = new Colyseus.Client('ws://' + window.location.host);
        log('✓ Client created');

        const room = await client.joinOrCreate('lobby', { name: 'TestPlayer' });
        log('✓ Connected to lobby room!');
        log('Session ID: ' + room.sessionId);
        log('Room ID: ' + room.roomId);

        room.onMessage('joined_lobby', (msg) => {
          log('✓ Received joined_lobby message: ' + JSON.stringify(msg));
        });

        room.onError((code, message) => {
          log('✗ Room error: ' + code + ' - ' + message);
        });

        // Send join_lobby message
        room.send('join_lobby', { name: 'TestPlayer' });
        log('✓ Sent join_lobby message');

      } catch (error) {
        log('✗ Error: ' + error.message);
        log('Stack: ' + error.stack);
      }
    });
  </script>
</body>
</html>
